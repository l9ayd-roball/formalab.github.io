<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Módulos</title>
    <meta name="description" content="Gestor de módulos para profesores" />
    <style>
         :root {
            --accent: #0f6cff;
            --muted: #6b7280;
            --bg: #f7fafc;
            --card: #ffffff;
            --danger: #ef4444
        }
        
        * {
            box-sizing: border-box
        }
        
        body {
            font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
            margin: 0;
            background: var(--bg);
            color: #0b1220
        }
        
        header {
            background: linear-gradient(90deg, #07203c, var(--accent));
            color: white;
            padding: 14px 20px
        }
        
        .container {
            max-width: 1100px;
            margin: 22px auto;
            padding: 0 16px
        }
        
        .brand {
            font-weight: 800;
            font-size: 1.1rem
        }
        
        nav.topnav {
            display: flex;
            gap: 12px;
            align-items: center
        }
        
        nav.topnav a {
            color: rgba(255, 255, 255, 0.95);
            text-decoration: none;
            font-weight: 600
        }
        
        .row {
            display: flex;
            gap: 16px;
            align-items: center
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px
        }
        
        .card {
            background: var(--card);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(2, 6, 23, 0.06)
        }
        
        .modules-list {
            display: grid;
            gap: 10px
        }
        
        .module-item {
            border: 1px solid #eef4ff;
            padding: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            gap: 12px
        }
        
        h2 {
            margin: 0 0 8px
        }
        
        .muted {
            color: var(--muted)
        }
        
        .btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 0;
            background: var(--accent);
            color: white;
            font-weight: 700;
            cursor: pointer
        }
        
        .outline {
            background: transparent;
            border: 1.5px solid #e6eefc;
            color: var(--accent)
        }
        
        table {
            width: 100%;
            border-collapse: collapse
        }
        
        th,
        td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9
        }
        
        .small {
            font-size: 0.9rem
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #eef7ff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700
        }
        
        .chips {
            display: flex;
            gap: 6px;
            flex-wrap: wrap
        }
        
        .chip {
            background: #f0f7ff;
            padding: 6px 8px;
            border-radius: 999px;
            font-weight: 700;
            color: var(--accent);
            font-size: 0.85rem
        }
        
        .actions button {
            margin-left: 6px
        }
        /* modal */
        
        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 23, 0.45);
            visibility: hidden;
            opacity: 0;
            transition: all .12s
        }
        
        .modal.open {
            visibility: visible;
            opacity: 1
        }
        
        .dialog {
            width: 720px;
            max-width: calc(100% - 32px);
            background: var(--card);
            padding: 18px;
            border-radius: 12px
        }
        
        label {
            display: block;
            margin-top: 10px;
            font-weight: 700
        }
        
        input[type=text],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e8edf5
        }
        
        textarea {
            min-height: 100px
        }
        
        footer {
            color: var(--muted);
            text-align: center;
            padding: 18px
        }
        
        @media (max-width:880px) {
            .grid {
                grid-template-columns: 1fr
            }
            .dialog {
                width: 92%
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="container row" style="justify-content:space-between;align-items:center">
            <div class="brand">Módulos</div>
            <nav class="topnav">
                <a href="index.html">Portal</a>
                <a href="module.html">Módulos</a>
                <a href="incprf.html">Incidencias</a>
                <a href="https://edu.google.com/intl/ALL_ca/workspace-for-education/products/classroom">Classroom</a>
                <button id="logoutBtn" class="btn outline">Cerrar sesión</button>
            </nav>
        </div>
    </header>

    <div class="container grid">
        <main>
            <section class="card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <div>
                        <h2>Módulos</h2>
                        <div class="muted">Gestiona módulos, profesores y recursos.</div>
                    </div>
                    <div>
                        <button id="newModuleBtn" class="btn">+ Nuevo módulo</button>
                    </div>
                </div>

                <div style="margin-top:12px">
                    <input id="searchModules" type="text" placeholder="Buscar módulo, código o profesor" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e8edf5" />
                </div>

                <div class="modules-list" id="modulesList" style="margin-top:12px">
                    <!-- lista generada por JS -->
                </div>
            </section>

            <section class="card" style="margin-top:12px">
                <h3>Historial de cambios</h3>
                <ul id="changelog" class="muted small" style="margin-top:8px"></ul>
            </section>
        </main>

        <aside>
            <div class="card">
                <h3>Estadísticas</h3>
                <table>
                    <tr>
                        <th>Valor</th>
                        <th class="muted">Detalle</th>
                    </tr>
                    <tr>
                        <td id="totalModules">0</td>
                        <td class="muted">Módulos activos</td>
                    </tr>
                    <tr>
                        <td id="totalTeachers">0</td>
                        <td class="muted">Profesores asignados</td>
                    </tr>
                    <tr>
                        <td id="totalStudents">0</td>
                        <td class="muted">Estudiantes totales (estimado)</td>
                    </tr>
                </table>

                <div style="margin-top:12px">
                    <h4>Profesores</h4>
                    <div id="teachersList" class="chips" style="margin-top:8px"></div>
                </div>
            </div>

            <div class="card" style="margin-top:12px">
                <h4>Recursos recientes</h4>
                <ul id="recentResources" class="muted small" style="margin-top:8px"></ul>
            </div>
        </aside>
    </div>

    <!-- Modal: Nuevo módulo -->
    <div id="modal" class="modal" role="dialog" aria-hidden="true">
        <div class="dialog">
            <h3 id="modalTitle">Nuevo módulo</h3>
            <form id="moduleForm">
                <label for="mName">Nombre del módulo</label>
                <input id="mName" type="text" required />

                <label for="mCode">Código</label>
                <input id="mCode" type="text" required />

                <label for="mSubject">Asignatura</label>
                <input id="mSubject" type="text" placeholder="Ej: Matemáticas" />

                <label for="mHours">Horas semanales</label>
                <input id="mHours" type="text" placeholder="Ej: 4" />

                <label for="mTeacher">Profesor asignado (correo)</label>
                <input id="mTeacher" type="text" placeholder="prof@example.com" />

                <label for="mResources">Recursos (URLs separadas por coma)</label>
                <input id="mResources" type="text" placeholder="https://... , https://..." />

                <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
                    <button class="btn" type="submit">Guardar</button>
                    <button id="closeModal" type="button" class="btn outline">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <footer>© <span id="year"></span>Portal para Profesores</footer>

    <script>
        // Datos simulados iniciales
        const modules = [{
            id: 1,
            name: 'Hardware',
            code: 'Hard-AL1',
            subject: 'Hardware',
            hours: 4,
            teacher: 'ana.perez@formalab.cat',
            students: 28,
            resources: ['https://drive.example/alg1.pdf']
        }, {
            id: 2,
            name: 'Castella',
            code: 'Cas-202',
            subject: 'Castella',
            hours: 5,
            teacher: 'juan.garcia@formalab.cat',
            students: 22,
            resources: ['https://youtu.be/example']
        }, {
            id: 3,
            name: 'Historia Moderna',
            code: 'HIST-101',
            subject: 'Historia',
            hours: 3,
            teacher: 'maria.lopez@formalab.cat',
            students: 30,
            resources: []
        }];

        const changelog = [];

        // Helpers DOM
        const modulesList = document.getElementById('modulesList');
        const teachersSet = new Set();

        function renderModules(filter = '') {
            modulesList.innerHTML = '';
            const f = filter.trim().toLowerCase();
            const visible = modules.filter(m => !f || (m.name + m.code + m.teacher + m.subject).toLowerCase().includes(f));
            visible.forEach(m => {
                const div = document.createElement('div');
                div.className = 'module-item';
                div.innerHTML = `
          <div>
            <div style="display:flex;gap:10px;align-items:center">
              <div class="avatar">${m.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
              <div>
                <div style="font-weight:800">${m.name} <span class="muted" style="font-weight:600">(${m.code})</span></div>
                <div class="muted small">${m.subject} • ${m.hours} h/sem • ${m.students} estudiantes</div>
              </div>
            </div>
            <div style="margin-top:8px" class="small muted">Profesor: ${m.teacher || 'No asignado'}</div>
            <div style="margin-top:8px" class="small">Recursos: ${m.resources.length}</div>
          </div>
          <div class="actions">
            <button class="btn outline" onclick="viewModule(${m.id})">Ver</button>
            <button class="btn" onclick="editModule(${m.id})">Editar</button>
            <button class="btn" style="background:var(--danger)" onclick="deleteModule(${m.id})">Borrar</button>
          </div>
        `;
                modulesList.appendChild(div);
            });
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalModules').textContent = modules.length;
            const teachers = new Set(modules.map(m => m.teacher).filter(Boolean));
            document.getElementById('totalTeachers').textContent = teachers.size;
            document.getElementById('totalStudents').textContent = modules.reduce((s, m) => s + m.students, 0);
            const tlist = document.getElementById('teachersList');
            tlist.innerHTML = '';
            teachers.forEach(t => {
                const c = document.createElement('div');
                c.className = 'chip';
                c.textContent = t;
                tlist.appendChild(c);
            });
            const rr = document.getElementById('recentResources');
            rr.innerHTML = '';
            const recent = modules.flatMap(m => m.resources.map(r => ({
                r,
                m
            }))).slice(0, 5);
            recent.forEach(x => {
                const li = document.createElement('li');
                li.textContent = `${x.r} (${x.m.code})`;
                rr.appendChild(li);
            });
        }

        // Modal & form
        const modal = document.getElementById('modal');
        const moduleForm = document.getElementById('moduleForm');
        const modalTitle = document.getElementById('modalTitle');
        let editId = null;

        document.getElementById('newModuleBtn').addEventListener('click', () => openModal());
        document.getElementById('closeModal').addEventListener('click', closeModal);

        function openModal(data) {
            modal.classList.add('open');
            modal.setAttribute('aria-hidden', 'false');
            if (data) {
                modalTitle.textContent = 'Editar módulo';
                editId = data.id;
                document.getElementById('mName').value = data.name;
                document.getElementById('mCode').value = data.code;
                document.getElementById('mSubject').value = data.subject;
                document.getElementById('mHours').value = data.hours;
                document.getElementById('mTeacher').value = data.teacher;
                document.getElementById('mResources').value = data.resources.join(', ');
            } else {
                modalTitle.textContent = 'Nuevo módulo';
                editId = null;
                moduleForm.reset();
            }
        }

        function closeModal() {
            modal.classList.remove('open');
            modal.setAttribute('aria-hidden', 'true');
        }

        moduleForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('mName').value.trim();
            const code = document.getElementById('mCode').value.trim();
            const subject = document.getElementById('mSubject').value.trim();
            const hours = parseInt(document.getElementById('mHours').value) || 0;
            const teacher = document.getElementById('mTeacher').value.trim();
            const resources = document.getElementById('mResources').value.split(',').map(s => s.trim()).filter(Boolean);
            if (editId) {
                const m = modules.find(x => x.id === editId);
                m.name = name;
                m.code = code;
                m.subject = subject;
                m.hours = hours;
                m.teacher = teacher;
                m.resources = resources;
                changelog.unshift(`${new Date().toLocaleString()} — Módulo ${m.code} editado`);
            } else {
                const newModule = {
                    id: Date.now(),
                    name,
                    code,
                    subject,
                    hours,
                    teacher,
                    students: 0,
                    resources
                };
                modules.unshift(newModule);
                changelog.unshift(`${new Date().toLocaleString()} — Módulo ${code} creado`);
            }
            renderModules(document.getElementById('searchModules').value);
            renderChangeLog();
            closeModal();
        });

        // Actions
        function viewModule(id) {
            const m = modules.find(x => x.id === id);
            if (!m) return alert('Módulo no encontrado');
            // Mostrar detalle simple en un alert (puedes reemplazar por un modal más completo)
            alert(`${m.name} (${m.code})\nAsignatura: ${m.subject}\nProfesor: ${m.teacher || 'No asignado'}\nHoras: ${m.hours}\nEstudiantes: ${m.students}\nRecursos:\n- ${m.resources.join('\n- ')}`);
        }

        function editModule(id) {
            const m = modules.find(x => x.id === id);
            if (!m) return;
            openModal(m);
        }

        function deleteModule(id) {
            if (!confirm('¿Borrar este módulo? Esta acción no se puede deshacer.')) return;
            const idx = modules.findIndex(x => x.id === id);
            if (idx >= 0) {
                changelog.unshift(`${new Date().toLocaleString()} — Módulo ${modules[idx].code} borrado`);
                modules.splice(idx, 1);
                renderModules();
                renderChangeLog();
            }
        }

        function renderChangeLog() {
            const cl = document.getElementById('changelog');
            cl.innerHTML = '';
            changelog.slice(0, 10).forEach(c => {
                const li = document.createElement('li');
                li.textContent = c;
                cl.appendChild(li);
            });
        }

        // Search
        document.getElementById('searchModules').addEventListener('input', (e) => renderModules(e.target.value));

        // Logout redirige a logout.html
        document.getElementById('logoutBtn').addEventListener('click', () => {
            window.location.href = 'logout.html';
        });

        // Init
        renderModules();
        renderChangeLog();
        updateStats();
        document.getElementById('year').textContent = new Date().getFullYear();

        // Accessibility: cerrar modal con Escape
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
        });
    </script>
</body>

</html>